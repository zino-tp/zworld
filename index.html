<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZWORLD</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #333;
            color: #eee;
            overflow: hidden;
        }
        #intro {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            animation: fadeIn 3s forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        #content {
            display: none;
            padding: 20px;
        }
        button {
            background: #444;
            color: #eee;
            border: none;
            padding: 10px;
            margin: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #555;
        }
        #tweetMedia {
            margin: 10px 0;
        }
        #tweetsBox, #globalChatBox {
            overflow-y: scroll;
            height: 300px;
            border: 1px solid #444;
            padding: 10px;
        }
        .tweet {
            border-bottom: 1px solid #444;
            margin-bottom: 10px;
            padding-bottom: 10px;
        }
        .tweet img, .tweet video {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div id="intro">Welcome to ZWORLD</div>
    <div id="content"></div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.getElementById('intro').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                showPage('home');
            }, 3000);
        });

        function showPage(page) {
            const content = document.getElementById('content');
            content.innerHTML = '';
            switch (page) {
                case 'home':
                    loadHome();
                    break;
                case 'globalChat':
                    loadGlobalChat();
                    break;
                case 'privateChat':
                    loadPrivateChat();
                    break;
                case 'postTweet':
                    loadPostTweet();
                    break;
                default:
                    loadHome();
            }
        }

        function loadHome() {
            const content = document.getElementById('content');
            const tweetsBox = document.createElement('div');
            tweetsBox.id = 'tweetsBox';
            content.appendChild(tweetsBox);
            fetchTweets();
        }

        async function fetchTweets() {
            try {
                const response = await fetch('/api/tweets');
                const tweets = await response.json();
                const tweetsBox = document.getElementById('tweetsBox');
                tweetsBox.innerHTML = '';
                tweets.forEach(tweet => {
                    const tweetDiv = document.createElement('div');
                    tweetDiv.className = 'tweet';
                    tweetDiv.innerHTML = `<strong>${tweet.title}</strong><p>${tweet.body}</p>`;
                    tweet.media.forEach(item => {
                        if (item.type === 'image') {
                            const img = document.createElement('img');
                            img.src = item.src;
                            tweetDiv.appendChild(img);
                        } else if (item.type === 'video') {
                            const video = document.createElement('video');
                            video.src = item.src;
                            video.controls = true;
                            tweetDiv.appendChild(video);
                        }
                    });
                    tweetsBox.appendChild(tweetDiv);
                });
            } catch (error) {
                console.error('Error fetching tweets:', error);
            }
        }

        async function loadPostTweet() {
            const content = document.getElementById('content');
            const tweetTitle = document.createElement('input');
            tweetTitle.type = 'text';
            tweetTitle.id = 'tweetTitle';
            tweetTitle.placeholder = 'Enter tweet title...';
            
            const tweetBody = document.createElement('textarea');
            tweetBody.id = 'tweetBody';
            tweetBody.placeholder = 'Enter tweet body...';
            
            const tweetMedia = document.createElement('input');
            tweetMedia.type = 'file';
            tweetMedia.id = 'tweetMedia';
            tweetMedia.multiple = true;
            
            const tweetButton = document.createElement('button');
            tweetButton.innerText = 'Post';
            tweetButton.onclick = async () => {
                const title = tweetTitle.value;
                const body = tweetBody.value;
                const mediaFiles = document.getElementById('tweetMedia').files;
                const media = [];

                if (title && body) {
                    for (let i = 0; i < mediaFiles.length; i++) {
                        const file = mediaFiles[i];
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            media.push({
                                type: file.type.startsWith('image') ? 'image' : 'video',
                                src: event.target.result
                            });
                            if (media.length === mediaFiles.length) {
                                postTweet({ title, body, media });
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                    
                    if (mediaFiles.length === 0) {
                        postTweet({ title, body, media });
                    }
                } else {
                    alert('Please enter both title and body.');
                }
            };
            
            content.appendChild(tweetTitle);
            content.appendChild(tweetBody);
            content.appendChild(tweetMedia);
            content.appendChild(tweetButton);
        }

        async function postTweet(tweet) {
            try {
                const response = await fetch('/api/tweet', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(tweet),
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                showPage('home');
            } catch (error) {
                console.error('Error posting tweet:', error);
            }
        }
    </script>
</body>
</html>
